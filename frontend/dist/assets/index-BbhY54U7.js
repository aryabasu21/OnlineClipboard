const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/monaco-g0fuAR-7.js","assets/monaco-Ct_p2bud.css","assets/convex-CLKx9Drj.js","assets/vendor-C380F9R8.js","assets/socket-DqgFvcK2.js"])))=>i.map(i=>d[i]);
import{_ as F}from"./monaco-g0fuAR-7.js";import{r as a,j as e,z as C,F as Fe,R as Ze,c as He}from"./react-vendor-QfLuIr0z.js";import{l as en}from"./socket-DqgFvcK2.js";import{b as nn}from"./vendor-C380F9R8.js";import"./prism-C5YQoA5D.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function f(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(r){if(r.ep)return;r.ep=!0;const d=f(r);fetch(r.href,d)}})();async function Je(i){const c=new TextEncoder,f=c.encode("online-clipboard-v1"),l=await crypto.subtle.importKey("raw",c.encode(i),"PBKDF2",!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:f,iterations:15e4,hash:"SHA-256"},l,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Oe(i,c){const f=await Je(i),l=crypto.getRandomValues(new Uint8Array(12)),r=new TextEncoder,d=await crypto.subtle.encrypt({name:"AES-GCM",iv:l},f,r.encode(c)),m=new Uint8Array(l.byteLength+d.byteLength);return m.set(l,0),m.set(new Uint8Array(d),l.byteLength),btoa(String.fromCharCode(...m))}async function B(i,c){try{const f=Uint8Array.from(atob(c),y=>y.charCodeAt(0)),l=f.slice(0,12),r=f.slice(12),d=await Je(i),m=await crypto.subtle.decrypt({name:"AES-GCM",iv:l},d,r);return new TextDecoder().decode(m)}catch{return null}}function $e({items:i,selected:c,expanded:f=new Set,onToggleSelect:l,onToggleExpand:r,onRestore:d,onEdit:m,onDelete:y,editingVersion:j,enableHighlight:g=!0,maxLines:w=3}){const[T,k]=a.useState(!1),E=a.useRef(!1);return a.useEffect(()=>{!g||T||E.current||!i.some(b=>b.lang&&b.lang!=="plain")||(E.current=!0,(async()=>{try{const b=(await F(async()=>{const{default:N}=await import("./prism-C5YQoA5D.js").then(S=>S.p);return{default:N}},[])).default||await F(()=>import("./prism-C5YQoA5D.js").then(N=>N.p),[]),x=["javascript","typescript","json","python","java","csharp","cpp","go","rust","sql"];await Promise.all(x.map(N=>F(()=>import(`prismjs/components/prism-${N}.js`),[]).catch(()=>{}))),requestAnimationFrame(()=>{window.Prism&&window.Prism.highlightAll&&window.Prism.highlightAll()}),k(!0)}catch{}})())},[g,T,i]),a.useEffect(()=>{var u;if(T&&((u=window.Prism)!=null&&u.highlightAll)){const b=requestAnimationFrame(()=>window.Prism.highlightAll());return()=>cancelAnimationFrame(b)}},[i,T]),i.length?e.jsx("ul",{className:"history-grid",role:"list","aria-label":"Clipboard history",children:i.slice().reverse().map(u=>{const b=c.has(u.version),x=j===u.version,N=(u.lang||"plain").toLowerCase(),S=f.has(u.version),H=!!u.preview&&(u.preview.length>140||u.preview.includes(`
`));return e.jsxs("li",{className:"hist-row"+(b?" sel":"")+(x?" editing":"")+(N!=="plain"?" code":"")+(S?" expanded":""),tabIndex:0,"aria-selected":b,"aria-expanded":S,"aria-label":`History version ${u.version}${x?" (editing)":""}`,onKeyDown:v=>{v.key===" "?(v.preventDefault(),l(u.version)):v.key==="Enter"&&d(u)},children:[e.jsxs("div",{className:"hist-main",style:{"--lines":w},children:[e.jsx("input",{"aria-label":b?"Deselect version":"Select version",type:"checkbox",checked:b,onChange:()=>l(u.version)}),e.jsxs("pre",{className:"hist-preview","aria-describedby":`meta-${u.version}`,children:[e.jsx("code",{className:`language-${N}`,children:u.preview||"..."}),H&&!S&&e.jsx("div",{className:"fade-edge","aria-hidden":"true"})]}),H&&e.jsx("button",{type:"button",className:"expand-btn",onClick:()=>r==null?void 0:r(u),"aria-expanded":S,"aria-label":S?"Collapse preview":"Expand to full",children:S?"Collapse":"Expand"}),e.jsxs("div",{id:`meta-${u.version}`,className:"hist-meta",children:[e.jsx("span",{className:"chip chip-lang",title:N,children:N}),e.jsxs("span",{className:"chip chip-ver",children:["v",u.version]}),x&&e.jsx("span",{className:"chip chip-edit",children:"Editing"})]})]}),e.jsxs("div",{className:"hist-actions","aria-label":`Actions for version ${u.version}`,children:[e.jsx("button",{className:"mini",onClick:()=>d(u),title:"Restore this version",children:"Restore"}),e.jsx("button",{className:"mini",disabled:j!=null&&!x,onClick:()=>m(u),title:x?"Finish editing in main panel":"Edit this version",children:x?"…":"Edit"}),e.jsx("button",{className:"mini danger",onClick:()=>y(u),title:"Delete this version",children:"Del"})]})]},u.version)})}):e.jsx("div",{className:"hist-empty",role:"status",children:"No history"})}function tn({code:i,link:c,qrDataUrl:f,copyState:l,copy:r,onLeave:d,onForget:m}){const[y,j]=a.useState(!1);return e.jsxs("div",{className:"share-wrapper"+(y?" collapsed":""),children:[e.jsxs("div",{className:"share-head-mobile",children:[e.jsx("strong",{children:"Share"}),e.jsx("button",{type:"button",className:"mini secondary",onClick:()=>j(g=>!g),"aria-expanded":!y,children:y?"Show":"Hide"})]}),!y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"share-grid",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Session Code"}),e.jsxs("div",{className:"inline-field",children:[e.jsx("input",{value:i,readOnly:!0,onClick:()=>r(i,"code")}),e.jsx("button",{onClick:()=>r(i,"code"),className:"mini",children:l.code?"Copied":"Copy"})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Sharable Link"}),e.jsxs("div",{className:"inline-field",children:[e.jsx("input",{value:c,readOnly:!0,onClick:()=>r(c,"link")}),e.jsx("button",{onClick:()=>r(c,"link"),className:"mini",children:l.link?"Copied":"Copy"})]})]})]}),e.jsxs("div",{className:"qr-flex",children:[f?e.jsx("img",{src:f,alt:"QR Code",className:"qr"}):e.jsx("div",{className:"qr placeholder",children:"QR"}),e.jsxs("div",{className:"qr-text",children:[e.jsx("p",{children:"Scan this code or use the session code above on any device. Everything stays end‑to‑end encrypted."}),e.jsx("p",{className:"hint",children:"Tip: First click copies. Long press on mobile to copy."}),e.jsxs("div",{className:"share-actions",children:[e.jsx("button",{className:"secondary mini",onClick:d,children:"Leave"}),e.jsx("button",{className:"secondary mini",onClick:m,children:"Leave & Forget"})]})]})]})]})]})}function sn({lang:i,autoFormat:c,setClipboard:f,ensurePrettier:l}){return a.useCallback(async r=>{try{const d=(r.clipboardData||window.clipboardData).getData("text");if(!d)return;if(c&&["javascript","typescript","json"].includes(i)){r.preventDefault();let m=d;if(i==="json")try{m=JSON.stringify(JSON.parse(d),null,2)}catch{}else try{const{prettier:y,plugins:j}=await l();m=await y.format(d,{parser:i==="typescript"?"typescript":"babel",plugins:j,semi:!0,singleQuote:!0})}catch{}f(y=>y?y+`
`+m:m)}}catch{}},[i,c,f,l])}let je;async function Ie(){return je||(je=F(()=>import("./monaco-g0fuAR-7.js").then(i=>i.e),__vite__mapDeps([0,1]))),je}const qe={plain:"plaintext",javascript:"javascript",typescript:"typescript",json:"json",python:"python",java:"java",csharp:"csharp",cpp:"cpp",go:"go",rust:"rust",sql:"sql"},Ve=a.forwardRef(function({value:c,onChange:f,lang:l,editingVersion:r,onSaveEdit:d,onCancelEdit:m,onPaste:y},j){const g=a.useRef(null),w=a.useRef(null),T=a.useRef(c);return a.useImperativeHandle(j,()=>({focus:()=>{var k;(k=w.current)==null||k.focus()},getEditor:()=>w.current})),a.useEffect(()=>{if(!g.current)return;let k=!0;return(async()=>{const E=await Ie();if(!k||!g.current)return;const{editor:u}=E,b=qe[l]||"plaintext";u.defineTheme("github-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#0d1117","editor.foreground":"#c9d1d9","editor.lineHighlightBackground":"#161b22","editorCursor.foreground":"#58a6ff","editor.selectionBackground":"#264f78","editor.inactiveSelectionBackground":"#22272e","editorLineNumber.foreground":"#8b949e","editorLineNumber.activeForeground":"#c9d1d9","editorIndentGuide.background":"#21262d","editorIndentGuide.activeBackground":"#484f58"}}),w.current=u.create(g.current,{value:c,language:b,theme:"github-dark",automaticLayout:!0,wordWrap:"on",minimap:{enabled:!1},fontSize:14,lineHeight:22,fontFamily:"JetBrains Mono, Fira Code, Cascadia Code, Consolas, monospace",smoothScrolling:!0,scrollBeyondLastLine:!1,padding:{top:8,bottom:16},renderWhitespace:"selection",tabSize:2,lineNumbersMinChars:2,lineDecorationsWidth:6,glyphMargin:!1,folding:!1,contextmenu:!1});const x=[],N=[];function S(A){if(y)return y(A)}g.current.addEventListener("paste",S,!0),x.push(w.current.onDidChangeModelContent(()=>{const A=w.current.getValue();T.current=A,f(A)}));const{KeyMod:H,KeyCode:v}=E;return N.push(w.current.addCommand(H.CtrlCmd|v.Enter,()=>{r!=null&&(d==null||d())})),N.push(w.current.addCommand(v.Escape,()=>{r!=null&&(m==null||m())})),()=>{var A,I;(A=g.current)==null||A.removeEventListener("paste",S,!0),x.forEach(O=>O&&typeof O.dispose=="function"&&O.dispose()),(I=w.current)==null||I.dispose()}})(),()=>{k=!1}},[]),a.useEffect(()=>{w.current&&(async()=>{const k=await Ie(),E=w.current.getModel(),u=qe[l]||"plaintext";u!=="plaintext"&&F(()=>import(`monaco-editor/esm/vs/basic-languages/${u}/${u}.js`),[]).catch(()=>{}),k.editor.setModelLanguage(E,u),w.current.updateOptions({lineNumbers:l==="plain"?"off":"on"})})()},[l]),a.useEffect(()=>{if(w.current&&c!==T.current){const k=w.current.getSelection();w.current.setValue(c),k&&w.current.setSelection(k),T.current=c}},[c]),e.jsx("div",{className:"monaco-clipboard",ref:g})}),ce={current:null};async function rn(){if(ce.current)return ce.current;const[i,c,f,l]=await Promise.all([F(()=>import("./prettier-B2qGhR67.js").then(r=>r.s),[]),F(()=>import("./prettier-B2qGhR67.js").then(r=>r.b),[]),F(()=>import("./prettier-B2qGhR67.js").then(r=>r.t),[]),F(()=>import("./prettier-B2qGhR67.js").then(r=>r.e),[])]);return ce.current={prettier:i.default,plugins:[c,f,l].map(r=>r.default||r)},ce.current}const Y="oc_last_session_v2";function on(){const[i,c]=a.useState(null),[f,l]=a.useState(null),[r,d]=a.useState(null),[m,y]=a.useState("idle"),[j,g]=a.useState(""),[w,T]=a.useState(null),[k,E]=a.useState([]),[u,b]=a.useState(!0),[x,N]=a.useState(new Set),[S,H]=a.useState(new Set),[v,A]=a.useState(null),[I,O]=a.useState(null),[D,J]=a.useState("plain"),[M,z]=a.useState(!0),[X,ge]=a.useState(!1),[Me,le]=a.useState(null),[we,be]=a.useState({code:!1,link:!1,clipboard:!1}),[ze,Z]=a.useState(!1),[Ke,ee]=a.useState(!1),[de,Ge]=a.useState(""),[q,Ce]=a.useState(""),[P,K]=a.useState(null),[ne,Ne]=a.useState(!1),$=a.useRef(null),te=a.useRef(!1),G=a.useRef(null),ke=a.useRef(!1),ue=a.useRef(null),he=a.useRef(null),se=a.useRef(null),U=(n,t)=>`${n}:${t}`,pe=(n,t)=>{try{localStorage.setItem(Y,JSON.stringify({code:n,linkToken:t}))}catch{}K({code:n,linkToken:t})},Ue=()=>{try{const n=localStorage.getItem(Y);n&&K(JSON.parse(n))}catch{}},Q=a.useCallback((n,t)=>{const s=`${window.location.protocol}//${window.location.hostname}:4000`,o=en(s,{transports:["websocket"],reconnection:!0});$.current=o,y("idle"),o.on("connect",()=>{y("connected"),o.emit("join",{room:n})}),o.on("reconnect_attempt",()=>y("reconnecting")),o.on("disconnect",()=>y("disconnected")),o.on("connect_error",()=>y("disconnected")),o.on("clipboard:updated",async({ciphertext:p,version:h})=>{T(h);const L=await B(t,p);L!=null&&g(R=>R===L?R:L),_(n,t)})},[]);async function Qe(){var p;if(i)return;const n=await((p=window.__convexClient)==null?void 0:p.mutation("functions:createSession",{}).catch(()=>null));if(!n)return alert("Failed to create session");const t=n.code,s=n.linkToken,o=U(t,s);c(t),l(`${window.location.origin}/join/${s}`),d(o),b(!0),pe(t,s),Q(t,o),j.trim()&&setTimeout(()=>fe(t,o,!0),60),_(t,o),W(t,o),ge(!0),C.success("Session created")}async function We(){var o;const n=de.trim();if(n.length!==5)return alert("Need 5-char code");const t=await((o=window.__convexClient)==null?void 0:o.query("functions:getSession",{code:n}).catch(()=>null));if(!t)return alert("Not found");const s=U(t.code,t.linkToken);c(t.code),l(`${window.location.origin}/join/${t.linkToken}`),d(s),t.currentLang&&J(t.currentLang),typeof t.autoFormat=="boolean"&&z(t.autoFormat),b(t.allowHistory),pe(t.code,t.linkToken),Q(t.code,s),_(t.code,s),W(t.code,s),C.success("Joined session "+t.code)}async function Ye(){var o;if(!q.trim())return;const n=q.trim().split("/").pop();if(!n)return alert("Invalid link");const t=await((o=window.__convexClient)==null?void 0:o.query("functions:joinByToken",{linkToken:n}).catch(()=>null));if(!t)return alert("Not found");const s=U(t.code,t.linkToken);c(t.code),l(`${window.location.origin}/join/${n}`),d(s),b(t.allowHistory),t.currentLang&&J(t.currentLang),typeof t.autoFormat=="boolean"&&z(t.autoFormat),pe(t.code,t.linkToken),Q(t.code,s),_(t.code,s),W(t.code,s),C.success("Joined via link")}async function _(n=i,t=r){var s,o;if(n)try{const p=await((s=window.__convexClient)==null?void 0:s.query("functions:getHistory",{code:n}))||[];if(t){const L=await Promise.all(p.map(async R=>{try{const ie=(await B(t,R.ciphertext)||"").split(/\r?\n/);let ye=[],xe=0;for(let oe=0;oe<ie.length&&oe<3;oe++){const ae=ie[oe];if(xe+ae.length>120){ye.push(ae.slice(0,120-xe)+"…");break}ye.push(ae),xe+=ae.length}return{...R,preview:ye.join(`
`),lang:R.lang||"plain"}}catch{return{...R,preview:"(decrypt error)"}}}));E(L),H(R=>new Set([...R].filter(re=>L.some(ie=>ie.version===re)))),L.length&&!G.current&&(G.current=L.reduce((R,re)=>Math.min(R,re.version),L[0].version))}else E(p.map(L=>({...L,preview:"(loading...)"})));const h=await((o=window.__convexClient)==null?void 0:o.query("functions:getSession",{code:n}).catch(()=>null));h&&(b(h.allowHistory),h.currentLang&&J(h.currentLang),typeof h.autoFormat=="boolean"&&z(h.autoFormat))}catch{C.error("History fetch failed")}}async function W(n=i,t=r){var s;if(!(!n||!t))try{const o=await((s=window.__convexClient)==null?void 0:s.query("functions:latestCiphertext",{code:n}));if(!o)return;T(o.version);const p=await B(t,o.ciphertext);p!=null&&(te.current=!0,g(p))}catch{C.error("Latest fetch failed")}}async function fe(n=i,t=r,s=!1){var L,R;if(!n||!t)return;const o=await Oe(t,j),p=u&&G.current!=null&&w!=null,h=await((L=window.__convexClient)==null?void 0:L.mutation("functions:updateClipboard",{code:n,ciphertext:o,replaceLatest:p,lang:D}).catch(()=>null));h&&(T(h.version),G.current||(G.current=h.version),(R=$.current)==null||R.emit("clipboard:update",{room:n,ciphertext:o,version:h.version}),s||_(n,t),Z(!0),setTimeout(()=>Z(!1),1500),C.success("Synced v"+h.version))}async function me(n){const t=await B(r,n.ciphertext);t!=null&&(te.current=!0,g(t),C("Version "+n.version+" restored"))}async function Se(n){var t;E(s=>s.filter(o=>o.version!==n.version));try{await((t=window.__convexClient)==null?void 0:t.mutation("functions:deleteHistory",{code:i,version:n.version})),_()}catch{_()}H(s=>{const o=new Set(s);return o.delete(n.version),o}),C("Deleted v"+n.version)}function _e(n){N(t=>{const s=new Set(t);return s.has(n)?s.delete(n):s.add(n),s})}async function Ee(){var t;if(!x.size)return;const n=[...x];E(s=>s.filter(o=>!x.has(o.version))),await((t=window.__convexClient)==null?void 0:t.mutation("functions:deleteHistoryBatch",{code:i,versions:n}).catch(()=>{})),N(new Set),_(),H(s=>{const o=new Set(s);return n.forEach(p=>o.delete(p)),o}),C("Deleted "+n.length+" items")}async function Le(n){await me(n),setTimeout(()=>{var t;return(t=ue.current)==null?void 0:t.focus()},20),A(n.version),he.current=n.ciphertext,setTimeout(()=>{se.current=j},25),C("Editing v"+n.version)}function Re(){v!=null&&((async()=>{try{const n=await B(r,he.current);n!=null&&g(n)}catch{}A(null),he.current=null,se.current=null})(),C("Edit cancelled"))}async function Te(n){if(H(t=>{const s=new Set(t);return s.has(n.version)?(s.delete(n.version),s):(s.add(n.version),s)}),r)try{const t=await B(r,n.ciphertext);t!=null&&E(s=>s.map(o=>o.version===n.version?{...o,preview:t}:o))}catch{}C((S.has(n.version)?"Collapsed ":"Expanded ")+"v"+n.version)}async function Ae(){var n,t;if(!(v==null||!i))try{O(null);const s=await Oe(r,j),o=await((n=window.__convexClient)==null?void 0:n.mutation("updateHistoryVersion:updateHistoryVersion",{code:i,version:v,ciphertext:s,lang:D}).catch(p=>{throw p}));if(o&&o.missing){O("Original version missing."),A(null),C.error("Cannot save: original missing");return}(t=$.current)==null||t.emit("clipboard:update",{room:i,ciphertext:s,version:v}),await _(i,r),A(null),Z(!0),setTimeout(()=>Z(!1),1300),C.success("Saved edit v"+v)}catch(s){O((s==null?void 0:s.message)||"Save failed"),C.error("Save failed")}}async function Xe(){var n;await((n=window.__convexClient)==null?void 0:n.mutation("functions:toggleHistory",{code:i}).catch(()=>{})),_(),C("History "+(u?"disabled":"enabled"))}function V({forget:n=!1}={}){var t;ke.current=!0;try{(t=$.current)==null||t.disconnect()}catch{}if($.current=null,c(null),l(null),d(null),E([]),T(null),y("idle"),N(new Set),A(null),n){try{localStorage.removeItem(Y)}catch{}K(null)}C("Left session"+(n?" (forgot)":""))}async function ve(n=!1){var s;if(!(P!=null&&P.code))return;const t=P.code;try{Ne(n);const o=await((s=window.__convexClient)==null?void 0:s.query("functions:getSession",{code:t}).catch(()=>null));if(!o)throw new Error("not found");const p=o.linkToken||P.linkToken,h=U(t,p);c(t),l(`${window.location.origin}/join/${p}`),d(h),b(o.allowHistory),Q(t,h),_(t,h),W(t,h),C.success("Rejoined "+t)}catch{try{localStorage.removeItem(Y)}catch{}K(null),C.error("Rejoin failed")}finally{Ne(!1)}}const Pe=sn({lang:D,autoFormat:M,setClipboard:g,ensurePrettier:rn});a.useEffect(Ue,[]),a.useEffect(()=>{!i&&P&&!ne&&!ke.current&&ve(!0)},[P,i,ne]),a.useEffect(()=>{if(!i||v!=null)return;if(te.current){te.current=!1;return}const n=setTimeout(()=>{j.trim()&&fe()},1400);return()=>clearTimeout(n)},[j,v,i,D,M]),a.useEffect(()=>{let n=!0;return(async()=>{if(f&&X)try{const t=await nn.toDataURL(f,{width:200,margin:1,color:{dark:"#1c2733",light:"#ffffff"}});n&&le(t)}catch{n&&le(null)}else le(null)})(),()=>{n=!1}},[f,X]),a.useEffect(()=>{if(i)return;const n=window.location.pathname.split("/").filter(Boolean);if(n[0]==="join"&&n[1]&&!q){const t=n[1],s=`${window.location.origin}/join/${t}`;Ce(s),(async()=>{var o;try{const p=await((o=window.__convexClient)==null?void 0:o.query("functions:joinByToken",{linkToken:t}));if(!p||i)return;const h=U(p.code,p.linkToken);c(p.code),l(s),d(h),b(p.allowHistory),Q(p.code,h),_(p.code,h),W(p.code,h)}catch{}})()}},[i,q]);function De(n,t){var p;const s=()=>{be(h=>({...h,[t]:!0})),setTimeout(()=>be(h=>({...h,[t]:!1})),1200)};(p=navigator.clipboard)!=null&&p.writeText?navigator.clipboard.writeText(n).then(s).catch(()=>{o(),s()}):(o(),s());function o(){const h=document.createElement("textarea");h.value=n,h.style.position="fixed",h.style.opacity="0",document.body.appendChild(h),h.select();try{document.execCommand("copy")}catch{}document.body.removeChild(h)}}return i?e.jsxs("div",{className:"session full-viewport",children:[e.jsx(Fe,{position:"top-right",toastOptions:{style:{background:"#1f2a36",color:"#c9d1d9",border:"1px solid #2b3947"}}}),m!=="connected"&&i&&e.jsxs("div",{className:`conn-banner ${m}`,children:[e.jsxs("strong",{children:[m==="reconnecting"&&"Reconnecting...",m==="disconnected"&&"Disconnected",m==="idle"&&"Connecting..."]}),e.jsxs("div",{className:"right",children:[e.jsx("button",{className:"secondary mini",onClick:()=>{if($.current)try{$.current.connect()}catch{}else P&&ve()},children:"Retry"}),e.jsx("button",{className:"secondary mini",onClick:()=>V(),children:"Leave"}),e.jsx("button",{className:"secondary mini",onClick:()=>V({forget:!0}),children:"Forget"})]})]}),e.jsxs("div",{className:"layout",children:[e.jsxs("div",{className:"main-card",children:[e.jsx("div",{className:"top-row-mobile",children:e.jsx("button",{className:"secondary mini show-history-btn",onClick:()=>ee(!0),children:"History"})}),e.jsxs("div",{className:"editor-header",children:[e.jsx("h2",{children:"Shared Clipboard"}),e.jsxs("div",{className:"editor-prefs",children:[e.jsxs("select",{value:D,onChange:async n=>{var s;const t=n.target.value;J(t);try{await((s=window.__convexClient)==null?void 0:s.mutation("functions:updateSessionPrefs",{code:i,lang:t,autoFormat:M}))}catch{}},children:[e.jsx("option",{value:"plain",children:"Plain"}),e.jsx("option",{value:"javascript",children:"JavaScript"}),e.jsx("option",{value:"typescript",children:"TypeScript"}),e.jsx("option",{value:"json",children:"JSON"}),e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"csharp",children:"C#"}),e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"go",children:"Go"}),e.jsx("option",{value:"rust",children:"Rust"}),e.jsx("option",{value:"sql",children:"SQL"})]}),e.jsxs("label",{className:"chk mini",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:async n=>{var s;const t=n.target.checked;z(t);try{await((s=window.__convexClient)==null?void 0:s.mutation("functions:updateSessionPrefs",{code:i,lang:D,autoFormat:t}))}catch{}}}),"Fmt"]})]})]}),e.jsx("div",{className:"shared-editor",children:e.jsx(Ve,{ref:ue,value:j,lang:D,onChange:n=>g(n),editingVersion:v,onSaveEdit:Ae,onCancelEdit:Re,onPaste:Pe})}),e.jsxs("div",{className:"status-bar",children:[e.jsxs("span",{className:"pill",children:["v",w??0]}),v!=null&&e.jsxs("span",{className:"pill warn",children:["Editing v",v]}),v!=null&&se.current!=null&&j!==se.current&&e.jsx("span",{className:"pill dirty",children:"Unsaved"}),ze&&e.jsx("span",{className:"pill good",children:"Synced"}),e.jsx("span",{className:"pill toggle",onClick:Xe,children:u?"History On":"History Off"}),e.jsx("span",{className:"muted flex1 right",children:"Autosaves while you type"})]}),I&&v==null&&e.jsxs("div",{className:"error-box",children:["Save error: ",I]}),v!=null&&e.jsxs("div",{className:"edit-hint",children:["Editing version ",v,". Ctrl/Cmd+Enter = Save, Esc = Cancel."]}),e.jsxs("div",{className:"actions wrap",children:[e.jsx("button",{onClick:()=>fe(),disabled:v!=null,children:"Force Sync"}),v!=null&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Ae,className:"good",children:"Save Edit"}),e.jsx("button",{className:"secondary",onClick:Re,children:"Cancel Edit"})]}),e.jsx("button",{className:"secondary",onClick:()=>_(),children:"Refresh History"}),e.jsx("button",{className:"secondary",onClick:()=>ge(n=>!n),children:X?"Hide Share":"Show Share"}),e.jsx("button",{className:"secondary",onClick:()=>De(j,"clipboard"),children:we.clipboard?"Copied":"Copy Text"}),e.jsx("button",{className:"secondary",onClick:()=>V(),children:"Leave"}),e.jsx("button",{className:"secondary",onClick:()=>V({forget:!0}),children:"Leave & Forget"})]}),X&&e.jsx(tn,{code:i,link:f,qrDataUrl:Me,copyState:we,copy:De,onLeave:()=>V(),onForget:()=>V({forget:!0})})]}),e.jsxs("div",{className:"side-card hide-on-narrow",children:[e.jsxs("div",{className:"side-head",children:[e.jsx("h2",{children:"History"}),e.jsxs("div",{className:"side-actions",children:[e.jsx("button",{className:"secondary mini",onClick:()=>_(),children:"Refresh"}),e.jsxs("button",{className:"secondary mini",disabled:!x.size,onClick:Ee,children:["Del Sel ",x.size||""]})]})]}),e.jsxs("div",{className:"side-meta",children:[e.jsxs("span",{className:"tiny muted",children:["Items: ",k.length]}),e.jsxs("span",{className:"tiny muted",children:["Lang: ",D]})]}),e.jsx("div",{className:"history-scroll",children:e.jsx($e,{items:k,selected:x,expanded:S,onToggleSelect:_e,onRestore:me,onEdit:Le,onDelete:Se,onToggleExpand:Te,editingVersion:v})})]})]}),Ke&&e.jsxs("div",{className:"history-drawer",children:[e.jsxs("div",{className:"drawer-head",children:[e.jsx("strong",{children:"History"}),e.jsxs("div",{className:"drawer-actions",children:[e.jsx("button",{className:"secondary mini",onClick:()=>_(),children:"Refresh"}),e.jsxs("button",{className:"secondary mini",disabled:!x.size,onClick:Ee,children:["Del Sel ",x.size||""]}),e.jsx("button",{className:"secondary mini",onClick:()=>ee(!1),children:"Close"})]})]}),e.jsx("div",{className:"drawer-body",children:e.jsx($e,{items:k,selected:x,expanded:S,onToggleSelect:_e,onRestore:n=>{me(n),ee(!1)},onEdit:n=>{Le(n),ee(!1)},onDelete:Se,onToggleExpand:Te,editingVersion:v,maxLines:4})})]})]}):e.jsxs("div",{className:"landing",children:[e.jsx(Fe,{position:"top-right",toastOptions:{style:{background:"#1f2a36",color:"#c9d1d9",border:"1px solid #2b3947"}}}),e.jsx("h1",{children:"Online Clipboard"}),e.jsx("p",{className:"lead",children:"Type or paste below. Create a session to sync securely across devices (end‑to‑end encrypted)."}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{children:"Draft Clipboard"}),e.jsxs("div",{className:"prefs-bar",children:[e.jsxs("select",{value:D,onChange:n=>J(n.target.value),children:[e.jsx("option",{value:"plain",children:"Plain"}),e.jsx("option",{value:"javascript",children:"JavaScript"}),e.jsx("option",{value:"typescript",children:"TypeScript"}),e.jsx("option",{value:"json",children:"JSON"}),e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"csharp",children:"C#"}),e.jsx("option",{value:"cpp",children:"C++"}),e.jsx("option",{value:"go",children:"Go"}),e.jsx("option",{value:"rust",children:"Rust"}),e.jsx("option",{value:"sql",children:"SQL"})]}),e.jsxs("label",{className:"chk",children:[e.jsx("input",{type:"checkbox",checked:M,onChange:n=>z(n.target.checked)})," ","Auto-format"]})]}),e.jsx("div",{className:"landing-editor",children:e.jsx(Ve,{ref:ue,value:j,lang:D,onChange:n=>g(n),editingVersion:null,onPaste:Pe})}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:Qe,disabled:!j.trim(),children:"Create Share Session"}),e.jsx("button",{className:"secondary",onClick:()=>g(""),children:"Clear"})]}),e.jsx("div",{className:"divider"}),e.jsx("h2",{children:"Join Existing"}),e.jsxs("div",{className:"join-row",children:[e.jsx("input",{placeholder:"5-char code",value:de,onChange:n=>Ge(n.target.value),maxLength:5}),e.jsx("button",{className:"secondary",onClick:We,disabled:de.trim().length!==5,children:"Join by Code"})]}),e.jsxs("div",{className:"join-row",children:[e.jsx("input",{placeholder:"Paste sharable link",value:q,onChange:n=>Ce(n.target.value)}),e.jsx("button",{className:"secondary",onClick:Ye,disabled:!q.trim(),children:"Join by Link"})]}),(P==null?void 0:P.code)&&e.jsxs("div",{className:"prev-session",children:[e.jsxs("p",{className:"muted",children:["Previous session: ",e.jsx("strong",{children:P.code})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:()=>ve(!1),disabled:ne,children:ne?"Rejoining...":"Rejoin"}),e.jsx("button",{className:"secondary",onClick:()=>{try{localStorage.removeItem(Y)}catch{}K(null)},children:"Forget"})]})]}),e.jsx("p",{className:"hint",children:"No data leaves your browser until you create or join a session."})]})]})}class an extends Ze.Component{constructor(c){super(c),this.state={error:null}}static getDerivedStateFromError(c){return{error:c}}componentDidCatch(c,f){console.error("App error boundary caught",c,f)}render(){return this.state.error?e.jsxs("div",{style:{padding:"1.5rem",fontFamily:"system-ui"},children:[e.jsx("h1",{children:"Something broke"}),e.jsx("p",{style:{opacity:.75},children:"An unexpected error occurred."}),e.jsx("pre",{style:{whiteSpace:"pre-wrap",fontSize:".65rem",background:"#111",padding:".75rem",borderRadius:6},children:String(this.state.error)}),e.jsx("button",{onClick:()=>location.reload(),children:"Reload"})]}):this.props.children}}const cn="https://disciplined-salmon-596.convex.cloud",Be=document.getElementById("app");(async()=>{try{const i=await F(()=>import("./convex-CLKx9Drj.js"),__vite__mapDeps([2,3,4])),c=i.ConvexClient||i.default||i,f=new c(cn);window.__convexClient={mutation:(l,r)=>f.mutation(l,r),query:(l,r)=>f.query(l,r)},He(Be).render(e.jsx(an,{children:e.jsx(on,{})}))}catch(i){console.error("Failed to initialize convex/browser client",i),He(Be).render(e.jsxs("div",{style:{padding:"1.5rem",fontFamily:"system-ui"},children:[e.jsx("h1",{children:"Convex Client Error"}),e.jsx("p",{children:"Could not load Convex browser client. Try reinstalling dependencies."}),e.jsx("pre",{style:{background:"#111",padding:"0.75rem 1rem",borderRadius:6,fontSize:"0.75rem",overflow:"auto"},children:String(i)})]}))}})();"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
